<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Slay-0.1 AI</title>

<style>
    body {
        margin: 0;
        padding: 0;
        background: #0d0d0d;
        font-family: 'Poppins', sans-serif;
        color: #fff;
        display: flex;
        flex-direction: column;
        height: 100vh;
        overflow: auto;
    }

    /* Header */
    .header {
        width: 100%;
        padding: 18px 0;
        text-align: center;
        font-size: 26px;
        font-weight: 700;
        background: linear-gradient(90deg, #7f00ff, #e100ff);
        box-shadow: 0 0 15px #9b00ff;
    }

    /* Chat box */
    #chat-box {
        flex: 1;
        overflow-y: auto;
        padding: 16px;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    /* Chat bubbles */
    .bubble {
        max-width: 80%;
        padding: 12px 16px;
        border-radius: 16px;
        line-height: 1.4;
        animation: fadeIn 0.3s ease;
    }

    .user {
        background: #7f00ff;
        align-self: flex-end;
        box-shadow: 0 0 8px #7f00ff;
    }

    .slay {
        background: #1a1a1a;
        border: 1px solid #7f00ff;
        box-shadow: 0 0 10px #7f00ff66;
        align-self: flex-start;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(5px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* Input area */
    .input-area {
        display: flex;
        padding: 10px;
        background: #111;
        gap: 10px;
    }

    input {
        flex: 1;
        padding: 14px;
        border-radius: 12px;
        border: none;
        outline: none;
        font-size: 16px;
        background: #222;
        color: white;
        box-shadow: inset 0 0 8px #7f00ff44;
    }

    button {
        padding: 14px 22px;
        font-size: 16px;
        font-weight: bold;
        border: none;
        border-radius: 12px;
        background: #7f00ff;
        color: #fff;
        box-shadow: 0 0 10px #7f00ff;
        cursor: pointer;
    }

    button:active {
        transform: scale(0.96);
    }

    /* Popup Modal */
    .popup-background {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.7);
        backdrop-filter: blur(4px);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 999;
    }

    .popup-box {
        background: #111;
        padding: 24px;
        width: 80%;
        max-width: 350px;
        border-radius: 12px;
        box-shadow: 0 0 12px #a200ff;
        text-align: center;
        border: 1px solid #7f00ff;
    }

    .popup-title {
        font-size: 22px;
        font-weight: 700;
        margin-bottom: 12px;
        color: #e100ff;
    }

    .popup-text {
        font-size: 15px;
        line-height: 1.4;
        margin-bottom: 20px;
    }

    .popup-btn {
        padding: 10px 18px;
        background: #7f00ff;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 15px;
        cursor: pointer;
        box-shadow: 0 0 10px #7f00ff;
    }
    /* Version Indicator */
    .version-indicator {
    width: 100%;
    text-align: center;
    font-size: 14px;
    padding: 6px 0;
    color: #cfcfcf;
    background: #101010;
    border-top: 1px solid #7f00ff44;
    box-shadow: 0 -2px 8px #7f00ff33;
    position: relative;
    }

    .version-indicator .upgrade {
    color: #e100ff;
    font-weight: 600;
    text-shadow: 0 0 6px #e100ff;
    }
</style>
</head>

<body>

<!-- POPUP -->
<div class="popup-background" id="popup">
    <div class="popup-box">
        <div class="popup-title">Developer's Note</div>

        <div class="popup-text" id="popupMessage">
            This is Slay-1 AI (Prototype 0.1).  
            Currently the AI is off
        </div>

        <button class="popup-btn" id="continueBtn">
            Continue
        </button>
    </div>
</div>

<div class="header">Slay-0.1 AI</div>

<div id="chat-box"></div>

<div class="input-area">
    <input type="text" id="userInput" placeholder="Ask Slay-0.1 something...">
    <button onclick="sendMessage()">Send</button>
</div>

<div class="version-indicator">
    Slay 0.1 â†’ <span class="upgrade">0.2 coming soon</span>
</div>

<script>
function closePopup() {
    const popup = document.getElementById("popup");
    if (popup) {
        popup.style.display = "none";
    }
}

function sendMessage() {
    const input = document.getElementById("userInput");
    const chat = document.getElementById("chat-box");

    if (!input || !chat) return;

    const message = input.value.trim();
    if (message === "") return;

    // show user bubble
    const userBubble = document.createElement("div");
    userBubble.className = "bubble user";
    userBubble.textContent = message;
    chat.appendChild(userBubble);
    chat.scrollTop = chat.scrollHeight;

    // clear input
    input.value = "";

    const lowerMsg = message.toLowerCase();

    // send to backend
    fetch("https://slay-backend-3.onrender.com/chat", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({ message: message })
    })
    .then(res => {
        if (!res.ok) {
            // e.g. 429, 500, etc.
            throw new Error("HTTP " + res.status);
        }
        return res.json();
    })
    .then(data => {
        const aiBubble = document.createElement("div");
        aiBubble.className = "bubble slay";
        aiBubble.textContent = data && data.reply
            ? data.reply
            : "Slay glitch ho gaya ðŸ˜­ (no reply from backend)";
        chat.appendChild(aiBubble);
        chat.scrollTop = chat.scrollHeight;
    })
    .catch(err => {
        console.log("Backend / network error:", err);

        const aiBubble = document.createElement("div");
        aiBubble.className = "bubble slay";

        // if user themselves typed stuff like "backend error"
        if (
            lowerMsg.includes("backend error") ||
            lowerMsg.includes("server down") ||
            lowerMsg.includes("backend failed") ||
            lowerMsg.includes("429")
        ) {
            aiBubble.textContent = "Chill Boss ðŸ’€ that message was from you, not the server. Slay is fine, Groq sometimes acts moody.";
        } else {
            aiBubble.textContent = "Backend error ðŸ˜­ â€” either Groq rate-limited or Render lagged. Wait a bit and try again.";
        }

        chat.appendChild(aiBubble);
        chat.scrollTop = chat.scrollHeight;
    });
}
</script>
    
<script>
// CLOSE POPUP FUNCTION
function closePopup() {
    document.getElementById("popup").style.display = "none";
}

// BIND BUTTON CLICK
document.getElementById("continueBtn").addEventListener("click", closePopup);
</script>

</body>
</html>
